<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Home Page</title>
        <link
            rel="shortcut icon"
            href="./assets/img/house-user-solid.svg"
            type="image/x-icon"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
            integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        />
        <link rel="stylesheet" href="./assets/css/style.css" />
        <link rel="stylesheet" href="./assets/css/home.css" />
    </head>
    <body>
        <div class="app">
            <header class="header">
                <div class="header-grid grid">
                    <div class="header-left">
                        <div class="header-left__logo">MPC</div>
                    </div>
                    <div class="header-right">
                        <div class="header-right__profile">
                            <div class="header-right__avt">
                                <i class="fa-solid fa-user"></i>
                            </div>
                            <ul class="profile__sub-menu">
                                <li class="profile__item">
                                    <div class="profile__item-icon">
                                        <i class="fa-solid fa-user-pen"></i>
                                    </div>
                                    <div class="profile__item-text">
                                        Edit Profile
                                    </div>
                                </li>
                                <li class="profile__item logout">
                                    <div class="profile__item-icon">
                                        <i
                                            class="fa-solid fa-arrow-right-from-bracket"
                                        ></i>
                                    </div>
                                    <div class="profile__item-text">Logout</div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </header>

            <div class="main grid">
                <div class="main-left">
                    <div class="main-left__search">
                        <div class="main-left__search-icon">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </div>
                        <input type="text" class="main-left__search-input" />
                    </div>
                    <div class="separate"></div>
                    <div class="main-left__nav">
                        <li class="main-left__item active">
                            <div class="main-left__item-icon">
                                <i class="fa-solid fa-house"></i>
                            </div>
                            <div class="main-left__item-text">Home</div>
                        </li>
                        <li class="main-left__item">
                            <div class="main-left__item-icon">
                                <i class="fa-brands fa-facebook-messenger"></i>
                            </div>
                            <div class="main-left__item-text">Messenger</div>
                        </li>
                        <li class="main-left__item">
                            <div class="main-left__item-icon">
                                <i class="fa-solid fa-bell"></i>
                            </div>
                            <div class="main-left__item-text">
                                Notifications
                            </div>
                        </li>
                    </div>
                    <div class="separate"></div>
                    <ul class="main-left__list">
                        <li class="main-left__item">
                            <div class="main-left__item-icon">
                                <i class="fa-solid fa-user-group"></i>
                            </div>
                            <div class="main-left__item-text">Friends</div>
                        </li>
                        <li class="main-left__item">
                            <div class="main-left__item-icon">
                                <i class="fa-solid fa-bookmark"></i>
                            </div>
                            <div class="main-left__item-text">Saved</div>
                        </li>
                        <li class="main-left__item">
                            <div class="main-left__item-icon">
                                <i class="fa-solid fa-gamepad"></i>
                            </div>
                            <div class="main-left__item-text">Games</div>
                        </li>
                        <li class="main-left__item">
                            <div class="main-left__item-icon">
                                <i class="fa-solid fa-layer-group"></i>
                            </div>
                            <div class="main-left__item-text">Group</div>
                        </li>
                        <li class="main-left__item">
                            <div class="main-left__item-icon">
                                <i class="fa-solid fa-star"></i>
                            </div>
                            <div class="main-left__item-text">Favorite</div>
                        </li>
                    </ul>
                    <div class="separate"></div>
                    <div class="main-left__mode">
                        <div class="main-left__mode-btn light">
                            <div class="main-left__mode-btn__icon">
                                <i class="fa-solid fa-sun"></i>
                            </div>
                            <div class="main-left__mode-btn__text">Light</div>
                        </div>
                        <div class="main-left__mode-btn dark">
                            <div class="main-left__mode-btn__icon">
                                <i class="fa-solid fa-moon"></i>
                            </div>
                            <div class="main-left__mode-btn__text">Dark</div>
                        </div>
                        <div class="main-left__mode-box"></div>
                    </div>
                </div>
                <div class="toggle-menu">
                    <i class="fa-solid fa-bars"></i>
                </div>
                <div class="main-mid">
                    <div class="main-mid__create-post">
                        <div class="create-post__avt">
                            <i class="fa-solid fa-user"></i>
                        </div>
                        <div class="create-post__input">
                            Hmm, what do you think?
                        </div>
                    </div>

                    <div class="main-mid__newfeeds"></div>
                </div>
                <div class="main-right">
                    <div class="main-right__heading">Online Users</div>
                    <div class="separate"></div>
                    <div class="main-right__list">
                        <div class="main-right__item">
                            <div class="main-right__item-avt">
                                <i class="fa-solid fa-user"></i>
                                <div class="main-right__item-avt--online"></div>
                            </div>
                            <div class="main-right__item-name">User 1</div>
                        </div>
                        <div class="main-right__item">
                            <div class="main-right__item-avt">
                                <i class="fa-solid fa-user"></i>
                                <div class="main-right__item-avt--online"></div>
                            </div>
                            <div class="main-right__item-name">User 2</div>
                        </div>
                        <div class="main-right__item">
                            <div class="main-right__item-avt">
                                <i class="fa-solid fa-user"></i>
                                <div class="main-right__item-avt--online"></div>
                            </div>
                            <div class="main-right__item-name">User 3</div>
                        </div>
                        <div class="main-right__item">
                            <div class="main-right__item-avt">
                                <i class="fa-solid fa-user"></i>
                                <div class="main-right__item-avt--online"></div>
                            </div>
                            <div class="main-right__item-name">User 4</div>
                        </div>
                    </div>

                    <div class="main-right__heading group">Online Group</div>
                    <div class="separate"></div>
                    <div class="main-right__list">
                        <div class="main-right__item">
                            <div class="main-right__item-avt">
                                <i class="fa-solid fa-layer-group"></i>
                                <div class="main-right__item-avt--online"></div>
                            </div>
                            <div class="main-right__item-name">Group 1</div>
                        </div>
                        <div class="main-right__item">
                            <div class="main-right__item-avt">
                                <i class="fa-solid fa-layer-group"></i>
                                <div class="main-right__item-avt--online"></div>
                            </div>
                            <div class="main-right__item-name">Group 2</div>
                        </div>
                        <div class="main-right__item">
                            <div class="main-right__item-avt">
                                <i class="fa-solid fa-layer-group"></i>
                                <div class="main-right__item-avt--online"></div>
                            </div>
                            <div class="main-right__item-name">Group 3</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal">
                <div class="modal-body">
                    <div class="post">
                        <div class="post-head">
                            <div class="post-heading">New Post</div>
                            <div class="post-close">
                                <i class="fa-solid fa-xmark"></i>
                            </div>
                        </div>
                        <div class="post-body">
                            <textarea
                                name=""
                                id=""
                                cols="30"
                                rows="10"
                                class="post-input"
                            ></textarea>
                        </div>
                        <div class="post-btn btn">POST</div>
                    </div>

                    <div class="confirm">
                        <div class="confirm-heading">
                            Are you sure about that?
                        </div>
                        <div class="separate"></div>
                        <div class="confirm-body">
                            <div class="confirm-btn yes btn">Yes</div>
                            <div class="confirm-btn no btn">No</div>
                        </div>
                    </div>
                </div>
            </div>

            <footer class="footer">
                <div class="footer-grid grid">
                    <div class="footer-content">Goodluck!</div>
                    <div class="box"></div>
                </div>
            </footer>
        </div>

        <script src="./assets/js/app.js"></script>
        <script>
            const app = (() => {
                const $ = document.querySelector.bind(document);
                const $$ = document.querySelectorAll.bind(document);

                const arr = [
                    {
                        id: 1,
                        author: "anvyidol",
                        content: "Hello Everyone ~",
                        isDeleted: false,
                    },
                    {
                        id: 2,
                        author: "anvyidol2",
                        content:
                            "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Nostrum voluptatibus animi, rerum expedita odit consectetur quis rem id suntnisi! Soluta minus consectetur ex laudantium. Dolore reprehenderit quod minus nulla.",
                        isDeleted: false,
                    },
                    {
                        id: 3,
                        author: "anvyidol",
                        content:
                            "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Nostrum voluptatibus animi, rerum expedita odit consectetur quis rem id suntnisi! Soluta minus consectetur ex laudantium. Dolore reprehenderit quod minus nulla.",
                        isDeleted: false,
                    },
                    {
                        id: 4,
                        author: "anvyidol2",
                        content:
                            "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Nostrum voluptatibus animi, rerum expedita odit consectetur quis rem id suntnisi! Soluta minus consectetur ex laudantium. Dolore reprehenderit quod minus nulla.",
                        isDeleted: false,
                    },
                    {
                        id: 5,
                        author: "anvyidol2",
                        content:
                            "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Nostrum voluptatibus animi, rerum expedita odit consectetur quis rem id suntnisi! Soluta minus consectetur ex laudantium. Dolore reprehenderit quod minus nulla.",
                        isDeleted: false,
                    },
                    {
                        id: 6,
                        author: "anvyidol",
                        content:
                            "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Nostrum voluptatibus animi, rerum expedita odit consectetur quis rem id suntnisi! Soluta minus consectetur ex laudantium. Dolore reprehenderit quod minus nulla.",
                        isDeleted: false,
                    },
                ];

                const users = JSON.parse(localStorage.getItem("users")) || [];
                const newfeeds =
                    JSON.parse(localStorage.getItem("newfeeds")) || arr;
                const userCurr = users.find((user) => user.isOnline === true);

                return {
                    render() {
                        const today = new Date();
                        const date = `0${today.getDate()}`.slice(-2);
                        const month = `0${today.getMonth() + 1}`.slice(-2);
                        const htmls = newfeeds
                            .map((newfeed) => {
                                if (!newfeed.isDeleted) {
                                    return `
                                <div class="newfeed">
                                    <div class="newfeed__head">
                                        <div class="newfeed__head-left">
                                            <div class="newfeed__avt">
                                                <i class="fa-solid fa-user"></i>
                                            </div>
                                            <div class="newfeed__status">
                                                <div class="newfeed__status-name">
                                                    ${newfeed.author}
                                                </div>
                                                <div class="newfeed__status-more">
                                                    <div class="newfeed__status-time">
                                                        ${date}/${month}
                                                    </div>
                                                    <div class="newfeed__status-icon">
                                                        <i
                                                            class="fa-solid fa-earth-americas"
                                                        ></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div style="display: ${
                                            newfeed.author ===
                                            userCurr?.username
                                                ? "block"
                                                : "none"
                                        }" class="newfeed__head-right">
                                            <div data-index="${
                                                newfeed.id
                                            }" class="newfeed__delete">
                                                <i class="fa-solid fa-trash"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="newfeed__content">
                                        ${newfeed.content}
                                    </div>
                                    <div class="newfeed__react">
                                        <div data-index=${
                                            newfeed.id
                                        } class="newfeed__react-icon ${
                                        userCurr?.liked.includes(newfeed.id)
                                            ? "active"
                                            : ""
                                    }">
                                            <i class="fa-solid fa-heart"></i>
                                        </div>
                                    </div>
                                </div>
                                `;
                                }
                            })
                            .join("");
                        $(".main-mid__newfeeds").innerHTML = htmls;
                        $(
                            ".create-post__input"
                        ).innerHTML = `Hmm, what do you think ${userCurr?.username}?`;
                    },
                    handleEvent() {
                        const modal = $(".modal");
                        const postBox = $(".post");
                        const confirmBox = $(".confirm");
                        const list = $(".main-mid__newfeeds");
                        const createPostBtn = $(".create-post__input");
                        const inputPost = $(".post-input");
                        const closePostBtn = $(".post-close");
                        const postBoxBtn = $(".post-btn.btn");
                        const yesBtn = $(".confirm-btn.yes");
                        const noBtn = $(".confirm-btn.no");
                        const logoutBtn = $(".profile__item.logout");
                        const lightBtn = $(".main-left__mode-btn.light");
                        const darkBtn = $(".main-left__mode-btn.dark");
                        const moveModeBtn = $(".main-left__mode-box");
                        const mainLeft = $(".main-left");
                        const toggle = $(".toggle-menu");
                        _this = this;

                        //mode
                        darkBtn.onclick = () => {
                            moveModeBtn.classList.add("active");
                            $(".app").classList.add("dark");
                        };

                        lightBtn.onclick = () => {
                            moveModeBtn.classList.remove("active");
                            $(".app").classList.remove("dark");
                        };

                        //toggle
                        toggle.onclick = () => {
                            mainLeft.classList.toggle("active");
                        };

                        window.onclick = (e) => {
                            const mainLeftE = e.target.closest(".main-left");
                            const toggleMenu = e.target.closest(".toggle-menu");
                            if (!mainLeftE && !toggleMenu) {
                                if (mainLeft.classList.contains("active")) {
                                    mainLeft.classList.remove("active");
                                }
                            }
                        };

                        //modal
                        closeModal = () => {
                            inputPost.value = null;
                            postBox.classList.remove("active");
                            confirmBox.classList.remove("active");
                            modal.classList.remove("active");
                        };

                        modal.onclick = function (e) {
                            const modalBody = e.target.closest(".modal-body");
                            if (!modalBody) {
                                closeModal();
                            }
                        };

                        createPostBtn.onclick = () => {
                            postBox.classList.add("active");
                            modal.classList.add("active");
                            inputPost.focus();
                        };

                        closePostBtn.onclick = () => {
                            closeModal();
                        };

                        //post

                        inputPost.oninput = function () {
                            if (
                                inputPost.value == null ||
                                inputPost.value == ""
                            ) {
                                postBoxBtn.classList.add("disabled");
                            } else {
                                postBoxBtn.classList.remove("disabled");
                            }
                        };

                        inputPost.onfocus = function () {
                            if (
                                inputPost.value == null ||
                                inputPost.value == ""
                            ) {
                                postBoxBtn.classList.add("disabled");
                            } else {
                                postBoxBtn.classList.remove("disabled");
                            }
                        };

                        postBoxBtn.onclick = function () {
                            const disabled =
                                postBoxBtn.classList.contains("disabled");
                            if (!disabled) {
                                const obj = {
                                    id: arr.length + 1,
                                    content: inputPost.value,
                                    isDeleted: false,
                                    author: userCurr?.username,
                                };
                                newfeeds.unshift(obj);
                                localStorage.setItem(
                                    "newfeeds",
                                    JSON.stringify(newfeeds)
                                );
                                _this.render();
                                closeModal();
                            }
                        };

                        list.onclick = (e) => {
                            const reactBtn = e.target.closest(
                                ".newfeed__react-icon"
                            );

                            const deleteBtn =
                                e.target.closest(".newfeed__delete");

                            if (reactBtn) {
                                const id = +reactBtn.dataset.index;
                                reactBtn.classList.toggle("active");
                                users.forEach((user) => {
                                    if (user.id === userCurr?.id) {
                                        const liked = user.liked.includes(id);
                                        if (liked) {
                                            user.liked = user.liked.filter(
                                                (postID) => postID != id
                                            );
                                        }
                                        if (!liked) {
                                            user.liked.push(id);
                                        }
                                    }
                                });
                                localStorage.setItem(
                                    "users",
                                    JSON.stringify(users)
                                );
                            }

                            if (deleteBtn) {
                                modal.classList.add("active");
                                confirmBox.classList.add("active");

                                yesBtn.onclick = () => {
                                    const id = deleteBtn.dataset.index;
                                    newfeeds.forEach((newfeed) => {
                                        if (newfeed.id == id) {
                                            newfeed.isDeleted = true;
                                        }
                                    });
                                    localStorage.setItem(
                                        "newfeeds",
                                        JSON.stringify(newfeeds)
                                    );
                                    closeModal();
                                    _this.render();
                                };

                                noBtn.onclick = () => {
                                    closeModal();
                                };
                            }
                        };

                        logoutBtn.onclick = () => {
                            users.forEach((user) => {
                                user.isOnline = false;
                            });

                            window.location.href = "./index.html";
                        };
                    },
                    start() {
                        this.render();
                        this.handleEvent();
                    },
                };
            })().start();
        </script>
    </body>
</html>
